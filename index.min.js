function getPixelData(imgA,imgB,done){getPixels(imgA,function(err,bmA){return err?done(err):void getPixels(imgB,function(err,bmB){done(err,bmA,bmB)})})}function compareByPixels(pxA,pxB){for(var diff=0,width=pxA.shape[0],height=pxA.shape[1],channels=pxA.shape[2],x=0;x<width;x++)for(var y=0;y<height;y++){for(var pxDiff=0,c=0;c<channels;c++)pxDiff=pxA.get(x,y,c)!=pxB.get(x,y,c),pxDiff&&(c=channels);diff+=pxDiff}return diff/(width*height)}function compareByChannels(pxA,pxB){for(var diff=0,width=pxA.shape[0],height=pxA.shape[1],channels=pxA.shape[2],x=0;x<width;x++)for(var y=0;y<height;y++)for(var c=0;c<channels;c++)diff+=void 0===pxB.get(x,y,c)?1:Math.abs((pxA.get(x,y,c)-pxB.get(x,y,c))/255);return diff/(width*height*channels)}var getPixels=require("get-pixels");exports.comparePixels=function(imgA,imgB,done){return exports.compare(imgA,imgB,compareByPixels,done)},exports.compareByChannels=function(imgA,imgB,done){return exports.compare(imgA,imgB,compareByData,done)},exports.compare=function(imgA,imgB,comparator,done){getPixelData(imgA,imgB,function(err,bitmapA,bitmapB){var diff;err||(diff=comparator(bitmapA,bitmapB)),done(err,diff)})};